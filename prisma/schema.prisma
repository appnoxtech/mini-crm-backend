generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int             @id @default(autoincrement())
  email             String          @unique
  name              String
  passwordHash      String
  profileImg        Json?
  phone             String?
  role              String?         @default("user")
  dateFormat        String?
  timezone          String?
  language          String?
  defaultCurrency   String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  generalActivities Activity[]
  calendarEvents    CalendarEvent[]
  callEvents        CallEvent[]
  assignedCalls     Call[]          @relation("CallAssigned")
  calls             Call[]
  activities        DealActivity[]
  dealHistories     DealHistory[]
  assignedDeals     Deal[]          @relation("DealAssigned")
  deals             Deal[]          @relation("DealOwner")
  emailAccounts     EmailAccount[]
  imports           Import[]
  labels            Label[]
  leads             Lead[]
  pipelines         Pipeline[]
  verifiedDealEmails DealEmail[]    @relation("DealEmailVerifiedBy")
  triggeredEmailLinkLogs EmailLinkLog[] @relation("EmailLinkLogTriggeredBy")

  @@map("users")
}

model Otp {
  id        Int      @id @default(autoincrement())
  email     String
  otp       String
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@map("otps")
}

model EmailAccount {
  id            String       @id @default(uuid())
  userId        Int
  email         String
  provider      String
  accessToken   String?
  refreshToken  String?
  imapConfig    String?
  smtpConfig    String?
  isActive      Boolean      @default(true)
  lastSyncAt    DateTime?
  lastHistoryId String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  user          User         @relation(fields: [userId], references: [id])
  drafts        EmailDraft[]
  emails        Email[]

  @@map("email_accounts")
}

model Email {
  id               String               @id @default(uuid())
  messageId        String
  threadId         String?
  accountId        String
  from             String               @map("from_address")
  to               Json                 @map("to_addresses")
  cc               Json?                @map("cc_addresses")
  bcc               Json?                @map("bcc_addresses")
  subject          String
  body             String
  htmlBody         String?
  isRead           Boolean              @default(false)
  isIncoming       Boolean              @default(true)
  sentAt           DateTime
  receivedAt       DateTime?
  contactIds       Json?
  dealIds          Json?
  accountEntityIds Json?
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  labelIds         Json?
  attachments      Json?
  uid              Int?
  folder           String?
  providerId       String?
  snippet          String?
  clicks           Int                  @default(0)
  lastClickedAt    DateTime?
  lastOpenedAt     DateTime?
  opens            Int                  @default(0)
  isLinkedToDeal   Boolean              @default(false)
  trackingEvents   EmailTrackingEvent[]
  account          EmailAccount         @relation(fields: [accountId], references: [id])
  content          EmailContent         @relation(fields: [messageId], references: [messageId])
  dealLinks        DealEmail[]

  @@unique([messageId, accountId])
  @@index([accountId, sentAt(sort: Desc)])
  @@index([isLinkedToDeal])
  @@map("emails")
}

model EmailTrackingEvent {
  id        String   @id @default(uuid())
  emailId   String
  type      String
  ipAddress String?
  userAgent String?
  metadata  Json?
  createdAt DateTime @default(now())
  email     Email    @relation(fields: [emailId], references: [id], onDelete: Cascade)

  @@index([emailId])
  @@map("email_tracking_events")
}

model EmailContent {
  messageId   String   @id
  body        String
  htmlBody    String?
  attachments Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  emails      Email[]

  @@map("email_contents")
}

model ThreadSummary {
  threadId         String    @id @map("thread_id")
  summary          String
  keyPoints        Json?     @map("key_points")
  actionItems      Json?     @map("action_items")
  sentiment        String?
  participants     Json?
  processingTime   Int?      @map("processing_time")
  modelVersion     String?   @map("model_version")
  status           String    @default("pending")
  runpodJobId      String?   @map("runpod_job_id")
  submittedAt      DateTime? @map("submitted_at")
  completedAt      DateTime? @map("completed_at")
  lastSummarizedAt DateTime  @map("last_summarized_at")

  @@map("thread_summaries")
}

model EmailDraft {
  id                   String       @id @default(uuid())
  accountId            String
  userId               Int
  toRecipients         Json         @map("to_recipients")
  ccRecipients         Json?        @map("cc_recipients")
  bccRecipients        Json?        @map("bcc_recipients")
  subject              String
  body                 String
  htmlBody             String?      @map("html_body")
  attachments          Json?
  replyToMessageId     String?      @map("reply_to_message_id")
  forwardFromMessageId String?      @map("forward_from_message_id")
  threadId             String?      @map("thread_id")
  contactIds           Json?        @map("contact_ids")
  dealIds              Json?        @map("deal_ids")
  accountEntityIds     Json?        @map("account_entity_ids")
  isScheduled          Boolean      @default(false) @map("is_scheduled")
  scheduledFor         DateTime?    @map("scheduled_for")
  createdAt            DateTime     @default(now()) @map("created_at")
  updatedAt            DateTime     @updatedAt @map("updated_at")
  providerId           String?      @map("provider_id")
  remoteUid            String?      @map("remote_uid")
  from                 String?
  isTrashed            Boolean      @default(false) @map("is_trashed")
  account              EmailAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([accountId])
  @@index([createdAt(sort: Desc)])
  @@index([isScheduled, scheduledFor])
  @@index([isTrashed])
  @@index([userId, isTrashed])
  @@map("email_drafts")
}

model Lead {
  id        Int           @id @default(autoincrement())
  name      String
  company   String?
  value     Float?
  stage     String        @default("OPEN")
  notes     String?
  userId    Int
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  closedAt  DateTime?
  history   LeadHistory[]
  user      User          @relation(fields: [userId], references: [id])

  @@map("leads")
}

model LeadHistory {
  id     Int      @id @default(autoincrement())
  leadId Int
  type   String
  text   String
  at     DateTime @default(now())
  lead   Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@map("lead_history")
}

model Pipeline {
  id          Int             @id @default(autoincrement())
  name        String
  description String?
  userId      Int
  isDefault   Boolean         @default(false)
  isActive    Boolean         @default(true)
  dealRotting Boolean         @default(false)
  rottenDays  Int             @default(30)
  ownerIds    Json?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  deals       Deal[]
  labels      Label[]
  stages      PipelineStage[]
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("pipelines")
}

model PipelineStage {
  id          Int           @id @default(autoincrement())
  pipelineId  Int
  name        String
  orderIndex  Int
  rottenDays  Int?
  probability Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  historyFrom DealHistory[] @relation("HistoryFromStage")
  historyTo   DealHistory[] @relation("HistoryToStage")
  deals       Deal[]
  pipeline    Pipeline      @relation(fields: [pipelineId], references: [id], onDelete: Cascade)

  @@unique([pipelineId, orderIndex])
  @@map("pipeline_stages")
}

model Deal {
  id                   Int            @id @default(autoincrement())
  title                String
  value                Float?         @default(0)
  currency             String?        @default("USD")
  pipelineId           Int
  stageId              Int
  email                Json?
  phone                Json?
  description          String?
  expectedCloseDate    DateTime?
  actualCloseDate      DateTime?
  probability          Int            @default(0)
  userId               Int
  assignedTo           Int?
  status               String?        @default("OPEN")
  lostReason           String?
  lastActivityAt       DateTime?
  isRotten             Boolean        @default(false)
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  deletedAt            DateTime?
  archivedAt           DateTime?
  personId             Int?
  organizationId       Int?
  source               String?
  labelIds             Json?
  customFields         Json?
  ownerIds             Json?
  isVisibleToAll       Boolean        @default(true)
  emailSyncStatus      String?        @default("not_synced")
  emailLastSyncedAt    DateTime?
  linkedEmailsCount    Int            @default(0)
  calls                Call[]
  activities           DealActivity[]
  history              DealHistory[]
  assignedUser         User?          @relation("DealAssigned", fields: [assignedTo], references: [id])
  organization         Organization?  @relation(fields: [organizationId], references: [id])
  person               Person?        @relation(fields: [personId], references: [id])
  pipeline             Pipeline       @relation(fields: [pipelineId], references: [id])
  stage                PipelineStage  @relation(fields: [stageId], references: [id])
  user                 User           @relation("DealOwner", fields: [userId], references: [id], onDelete: Cascade)
  products             Product[]
  emailLinks           DealEmail[]

  @@index([emailSyncStatus])
  @@map("deals")
}

model DealHistory {
  id            Int            @id @default(autoincrement())
  dealId        Int
  userId        Int
  eventType     String
  fromValue     String?
  toValue       String?
  fromStageId   Int?
  toStageId     Int?
  stageDuration Float?
  description   String?
  metadata      String?
  createdAt     DateTime       @default(now())
  leftAt        DateTime?
  deal          Deal           @relation(fields: [dealId], references: [id], onDelete: Cascade)
  fromStage     PipelineStage? @relation("HistoryFromStage", fields: [fromStageId], references: [id])
  toStage       PipelineStage? @relation("HistoryToStage", fields: [toStageId], references: [id])
  user          User           @relation(fields: [userId], references: [id])

  @@map("deal_history")
}

model DealEmail {
  id                Int      @id @default(autoincrement())
  dealId            Int      @map("deal_id")
  emailId           String   @map("email_id")
  linkedAt          DateTime @default(now()) @map("linked_at")
  linkedMethod      String   @map("linked_method")
  confidenceScore   Int?     @map("confidence_score")
  isVerified        Boolean  @default(false) @map("is_verified")
  verifiedByUserId  Int?     @map("verified_by_user_id")
  verifiedAt        DateTime? @map("verified_at")
  deal              Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
  email             Email    @relation(fields: [emailId], references: [id], onDelete: Cascade)
  verifiedBy        User?    @relation("DealEmailVerifiedBy", fields: [verifiedByUserId], references: [id])

  @@unique([dealId, emailId])
  @@index([dealId])
  @@index([emailId])
  @@index([isVerified])
  @@index([linkedMethod])
  @@map("deal_emails")
}

model EmailLinkLog {
  id                Int       @id @default(autoincrement())
  operationType     String    @map("operation_type")
  dealsProcessed    Int       @default(0) @map("deals_processed")
  linksCreated      Int       @default(0) @map("links_created")
  startedAt         DateTime  @map("started_at")
  completedAt       DateTime? @map("completed_at")
  status            String    @default("pending")
  errorMessage      String?   @map("error_message")
  triggeredByUserId Int?      @map("triggered_by_user_id")
  metadata          Json?
  triggeredBy       User?     @relation("EmailLinkLogTriggeredBy", fields: [triggeredByUserId], references: [id])

  @@index([status])
  @@index([startedAt(sort: Desc)])
  @@map("email_link_log")
}


model Product {
  id          Int       @id @default(autoincrement())
  dealId      Int
  userId      Int
  title       String
  price       Float
  quantity    Float
  tax         Float
  amount      Float
  discount    Float?
  billingDate DateTime?
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deal        Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@map("products")
}

model Label {
  id             Int           @id @default(autoincrement())
  value          String
  color          String?
  orderIndex     Int
  pipelineId     Int?
  userId         Int?
  organizationId Int?
  personId       Int?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organization   Organization? @relation(fields: [organizationId], references: [id])
  person         Person?       @relation(fields: [personId], references: [id])
  pipeline       Pipeline?     @relation(fields: [pipelineId], references: [id])
  user           User?         @relation(fields: [userId], references: [id])

  @@map("labels")
}

model DealActivity {
  id           Int       @id @default(autoincrement())
  dealId       Int
  userId       Int
  activityType String
  subject      String?
  label        String?
  startDate    String?
  endDate      String?
  startTime    String?
  endTime      String?
  priority     String?
  busyFree     String?
  note         String?
  organization String?
  email        Json?
  files        Json?
  participants Json?
  deal         Json?
  persons      Json?
  mataData     Json?
  isDone       Boolean   @default(false)
  completedAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  dealRelation Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("deal_activities")
}

model Organization {
  id                Int       @id @default(autoincrement())
  name              String
  description       String?
  industry          String?
  website           String?
  status            String?   @default("active")
  emails            Json?
  phones            Json?
  annualRevenue     Float?
  numberOfEmployees Int?
  linkedinProfile   String?
  address           Json?
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  deletedAt         DateTime?
  deals             Deal[]
  labels            Label[]
  persons           Person[]

  @@map("organisations")
}

model Person {
  id             Int           @id @default(autoincrement())
  firstName      String
  lastName       String?
  organizationId Int?
  emails         Json?
  phones         Json?
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  deletedAt      DateTime?
  calls          Call[]
  deals          Deal[]
  labels         Label[]
  userEmails     PersonEmail[]
  userPhones     PersonPhone[]
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@map("persons")
}

model PersonEmail {
  id       Int    @id @default(autoincrement())
  personId Int
  email    String @unique
  person   Person @relation(fields: [personId], references: [id], onDelete: Cascade)

  @@map("person_emails")
}

model PersonPhone {
  id       Int    @id @default(autoincrement())
  personId Int
  phone    String @unique
  person   Person @relation(fields: [personId], references: [id], onDelete: Cascade)

  @@map("person_phones")
}

model Call {
  id               Int               @id @default(autoincrement())
  twilioCallSid    String?           @unique
  twilioAccountSid String?
  direction        String            @default("outbound")
  status           String            @default("initiated")
  fromNumber       String
  toNumber         String
  startTime        DateTime?
  answerTime       DateTime?
  endTime          DateTime?
  duration         Int               @default(0)
  ringDuration     Int?
  userId           Int
  contactId        Int?
  dealId           Int?
  leadId           Int?
  disposition      String?
  notes            String?
  summary          String?
  queueName        String?
  assignedAgentId  Int?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  deletedAt        DateTime?
  events           CallEvent[]
  participants     CallParticipant[]
  recordings       CallRecording[]
  assignedAgent    User?             @relation("CallAssigned", fields: [assignedAgentId], references: [id])
  contact          Person?           @relation(fields: [contactId], references: [id])
  deal             Deal?             @relation(fields: [dealId], references: [id])
  user             User              @relation(fields: [userId], references: [id])

  @@map("calls")
}

model CallParticipant {
  id             Int       @id @default(autoincrement())
  callId         Int
  participantSid String?
  phoneNumber    String
  name           String?
  role           String    @default("callee")
  joinTime       DateTime?
  leaveTime      DateTime?
  muted          Boolean   @default(false)
  hold           Boolean   @default(false)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  call           Call      @relation(fields: [callId], references: [id], onDelete: Cascade)

  @@map("call_participants")
}

model CallRecording {
  id                  Int      @id @default(autoincrement())
  callId              Int
  recordingSid        String?  @unique
  recordingUrl        String?
  localFilePath       String?
  duration            Int      @default(0)
  fileSize            Int?
  channels            Int      @default(1)
  status              String   @default("processing")
  transcriptionSid    String?
  transcriptionText   String?
  transcriptionStatus String?
  transcriptionUrl    String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  call                Call     @relation(fields: [callId], references: [id], onDelete: Cascade)

  @@map("call_recordings")
}

model EmailSyncState {
  id            String   @id @default(uuid())
  accountId     String
  folder        String
  lastSyncedUid Int      @default(0)
  updatedAt     DateTime @updatedAt

  @@unique([accountId, folder])
  @@map("email_sync_state")
}

model CallEvent {
  id          Int      @id @default(autoincrement())
  callId      Int
  eventType   String
  eventData   String?
  triggeredBy Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  call        Call     @relation(fields: [callId], references: [id], onDelete: Cascade)
  user        User?    @relation(fields: [triggeredBy], references: [id])

  @@map("call_events")
}

model Import {
  id                Int             @id @default(autoincrement())
  userId            Int
  entityType        String
  fileName          String
  fileFormat        String
  status            String          @default("pending")
  totalRows         Int             @default(0)
  processedRows     Int             @default(0)
  successCount      Int             @default(0)
  errorCount        Int             @default(0)
  skippedCount      Int             @default(0)
  duplicateHandling String          @default("skip")
  mapping           Json?
  filePath          String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  completedAt       DateTime?
  errorSummary      String?
  errors            ImportError[]
  records           ImportRecord[]
  staging           ImportStaging[]
  user              User            @relation(fields: [userId], references: [id])

  @@map("imports")
}

model ImportError {
  id         Int      @id @default(autoincrement())
  importId   Int
  rowNumber  Int
  columnName String?
  value      String?
  errorType  String
  message    String
  createdAt  DateTime @default(now())
  import     Import   @relation(fields: [importId], references: [id], onDelete: Cascade)

  @@map("import_errors")
}

model ImportRecord {
  id        Int      @id @default(autoincrement())
  importId  Int
  entityId  Int
  action    String
  createdAt DateTime @default(now())
  import    Import   @relation(fields: [importId], references: [id], onDelete: Cascade)

  @@map("import_records")
}

model ImportTemplate {
  id         Int      @id @default(autoincrement())
  userId     Int
  name       String
  entityType String
  mapping    Json
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("import_templates")
}

model ImportStaging {
  id        Int      @id @default(autoincrement())
  importId  Int
  data      Json
  rowNumber Int
  createdAt DateTime @default(now())
  import    Import   @relation(fields: [importId], references: [id], onDelete: Cascade)

  @@map("import_staging")
}

model CalendarEvent {
  id            Int                 @id @default(autoincrement())
  userId        Int
  title         String
  description   String?
  startTime     DateTime
  endTime       DateTime
  location      String?
  isAllDay      Boolean             @default(false)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  deletedAt     DateTime?
  user          User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  notifications EventNotification[]
  reminders     EventReminder[]
  shares        EventShare[]

  @@map("calendar_events")
}

model EventReminder {
  id                    Int                 @id @default(autoincrement())
  eventId               Int
  reminderMinutesBefore Int
  isDefault             Boolean             @default(false)
  createdAt             DateTime            @default(now())
  notifications         EventNotification[]
  event                 CalendarEvent       @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_reminders")
}

model EventShare {
  id               Int           @id @default(autoincrement())
  eventId          Int
  sharedWithUserId Int
  participantType  String        @default("user")
  createdAt        DateTime      @default(now())
  event            CalendarEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, sharedWithUserId, participantType])
  @@map("event_shares")
}

model EventNotification {
  id            Int           @id @default(autoincrement())
  eventId       Int
  reminderId    Int
  userId        Int
  userType      String        @default("user")
  scheduledAt   DateTime
  status        String        @default("pending")
  inAppSentAt   DateTime?
  emailSentAt   DateTime?
  failureReason String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  event         CalendarEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  reminder      EventReminder @relation(fields: [reminderId], references: [id], onDelete: Cascade)

  @@unique([eventId, reminderId, userId, userType])
  @@map("event_notifications")
}

model PricingTier {
  id            String         @id @default(uuid())
  name          String
  basePrice     Float
  currency      String         @default("EUR")
  features      Json?
  contractTerms String?
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  discountRules DiscountRule[]

  @@map("pricing_tiers")
}

model DiscountRule {
  id         String      @id @default(uuid())
  tierId     String
  type       String
  percentage Float
  conditions Json?
  createdAt  DateTime    @default(now())
  tier       PricingTier @relation(fields: [tierId], references: [id], onDelete: Cascade)

  @@map("discount_rules")
}

model BrandGuidelines {
  id                   String   @id @default("default")
  tone                 String   @default("professional")
  voiceCharacteristics Json?
  openingPhrases       Json?
  closingPhrases       Json?
  signatureTemplate    String?
  ctaPatterns          Json?
  avoidPhrases         Json?
  updatedAt            DateTime @default(now()) @updatedAt

  @@map("brand_guidelines")
}

model KnowledgeBase {
  id        Int      @id @default(autoincrement())
  category  String
  topic     String
  content   String
  keywords  Json?
  updatedAt DateTime @default(now()) @updatedAt

  @@map("knowledge_base")
}

model ClientProfile {
  id                String   @id @default(uuid())
  dealId            Int?
  personId          Int?
  organizationId    Int?
  requirements      Json?
  budgetMin         Float?
  budgetMax         Float?
  timeline          String?
  decisionMakers    Json?
  objections        Json?
  preferences       Json?
  relationshipStage String?
  maturityScore     Float?
  lastUpdated       DateTime @default(now()) @updatedAt
  createdAt         DateTime @default(now())

  @@map("client_profiles")
}

model EmailSuggestion {
  id              String    @id @default(uuid())
  dealId          Int?
  personId        Int?
  subjectLine     String
  body            String
  htmlBody        String?
  emailType       String
  confidenceScore Float?
  reasoning       String?
  qualityScore    Float?
  issues          Json?
  status          String    @default("generated")
  userEdits       String?
  sentAt          DateTime?
  createdAt       DateTime  @default(now())

  @@map("email_suggestions")
}

model Activity {
  id              String   @id @default(uuid())
  title           String
  description     String?
  type            String   @default("meeting")
  startAt         DateTime
  endAt           DateTime
  priority        String   @default("medium")
  status          String   @default("busy")
  isDone          Boolean  @default(false)
  location        String?
  videoCallLink   String?
  createdBy       Int
  assignedUserIds Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [createdBy], references: [id])

  @@map("activities")
}

model StructuredKnowledgeBase {
  id                           String   @id @default("default")
  category_1_company_profile   Json?
  category_2_products_services Json?
  category_3_sales_process     Json?
  category_4_customers_markets Json?
  category_5_common_scenarios  Json?
  category_6_communication     Json?
  category_7_operations        Json?
  category_8_resources         Json?
  category_9_pricing           Json?
  version                      Int      @default(1)
  completion_percent           Float    @default(0)
  updated_at                   DateTime @default(now()) @updatedAt

  @@map("structured_knowledge_base")
}

model StructuredKBVersion {
  id              String   @id @default(uuid())
  kbId            String   @map("kb_id")
  version         Int
  fullKBSnapshot  Json     @map("full_kb_snapshot")
  changedSections Json     @map("changed_sections")
  changedBy       String?  @map("changed_by")
  changeTimestamp DateTime @default(now()) @map("change_timestamp")

  @@unique([kbId, version])
  @@map("structured_kb_versions")
}
